<div class="card">
    <div class="card-header">Manage Job Input Files</div>
    <!-- TODO: Unsure where this will sit, if it's a full pager style body to fill vertically using calc -->
    <div class="card-body datasetsTablePanel">
        <div style="margin:10px;" *ngIf="jobInputNodes.length === 0">
            This job doesn't have any input files or service downloads configured. You can add some by using the add button below or by selecting
            a dataset from the
            <a [routerLink]="['/data']">datasets page</a>.
        </div>
        <!-- TODO: Actions currently via context menu, do we need an action column to match some other tables? -->
        <p-treeTable *ngIf="jobInputNodes.length > 0" [value]="jobInputNodes" [columns]="treeCols" [resizableColumns]="true" selectionMode="single"
            [(selection)]="selectedJobInputNode" (onNodeSelect)="jobInputSelected($event)" [contextMenu]="jobInputContextMenu"
            [(contextMenuSelection)]="selectedContextNode" (onContextMenuSelect)="contextMenuSelected($event)">
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" [(ngStyle)]="col.colStyle" ttResizableColumn>{{ col.header }}</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
                <tr [ttSelectableRow]="rowNode" [ttContextMenuRow]="rowNode">
                    <td>
                        <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>{{ rowData.name }}</td>
                    <td>{{ rowData.location }}</td>
                    <td title="{{ rowData.description }}">{{ rowData.description }}</td>
                    <td title="{{ rowData.details }}" >
                        <span class="d-inline-block text-truncate" style="max-width:220px" *ngIf="rowData.leaf && rowNode.parent.data.id==='remote'"
                            title="{{ rowData.details }}">Service call to
                            <a href="{{ rowData.details }}">{{ rowData.details }}</a>
                        </span>
                        <span *ngIf="rowData.leaf && rowNode.parent.data.id==='remote'">
                            <button title="Edit the download options" (click)="editDownload($event,rowData.input)" >
                                <i class="fa fa-edit"></i>
                            </button>
                        </span>
                        <span *ngIf="rowData.leaf && rowNode.parent.data.id==='upload'" title="{{ rowData.details }}">{{ rowData.details }}</span>
                    </td>
                </tr>
            </ng-template>
        </p-treeTable>
    </div>
    <div class="card-footer">
        <input class="inputfile" id="fileinput" type="file" multiple="multiple" (change)="uploadFile($event)">
        <label style="margin-left:10px;" for="fileinput" class="btn btn-sm btn-primary pull-right">
            <i class="fa fa-upload"></i>&nbsp;Upload File(s)
        </label>
        <button style="margin-left:10px;" class="btn btn-sm btn-primary pull-right" (click)="showAddRemoteDownloadDialog(addRemoteDownloadModal)">
            <i class="fa fa-download"></i>&nbsp;Remote Download</button>
        <button type="button" class="btn btn-sm btn-primary pull-right" (click)="copyFromJob()">
            <i class="fa fa-copy"></i>&nbsp;Copy From Job</button>
    </div>
</div>


<!-- Job download context menu -->
<p-contextMenu #jobInputContextMenu [model]="jobInputContextMenuItems" appendTo="body"></p-contextMenu>


<!-- Add remote download modal -->
<ng-template #addRemoteDownloadModal let-c="close">
    <div class="modal-header">
        <h4 class="modal-title">Download from remote service</h4>
        <button type="button" class="close" aria-label="Close" (click)="c('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form #downloadForm="ngForm">
        <div class="modal-body">
            <div class="form-group">
                <label class="required" for="url">URL</label>
                <!-- TODO: URL validation -->
                <input type="text" class="form-control" id="url" [(ngModel)]="remoteUrl" name="remoteUrl" placeholder="URL for the job to download"
                    required>
                <label class="required" for="location" style="margin-top:5px;">Location</label>
                <!-- TODO: Path validation -->
                <input type="text" class="form-control" id="location" [(ngModel)]="remoteLocation" name="remoteLocation" placeholder="File path where the downloaded data will be stored"
                    required>
                <label class="required" for="name" style="margin-top:5px;">Name</label>
                <input type="text" class="form-control" id="name" [(ngModel)]="remoteName" name="remoteName" required>
                <label class="required" for="description" style="margin-top:5px;">Description</label>
                <input type="text" class="form-control" id="description" [(ngModel)]="remoteDescription" name="remoteDescription" required>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn" [disabled]="!downloadForm.valid" (click)="c('OK click')">Create Input</button>
        </div>
    </form>
</ng-template>